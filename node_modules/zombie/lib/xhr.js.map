{"version":3,"sources":["xhr.js"],"names":[],"mappings":"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","file":"xhr.js","sourcesContent":["// Implemenets XMLHttpRequest.\n// See http://www.w3.org/TR/XMLHttpRequest/#the-abort()-method\n\n\nconst DOM   = require('./dom');\nconst URL   = require('url');\nconst Utils = require('jsdom/lib/jsdom/utils');\n\n\nclass XMLHttpRequest extends DOM.EventTarget {\n\n  constructor(window) {\n    this._window      = window;\n    this._browser     = window.browser;\n    // Pending request\n    this._pending     = null;\n    // Response headers\n    this.readyState   = XMLHttpRequest.UNSENT;\n\n    this.onreadystatechange = null;\n    this.timeout      = 0;\n\n    // XHR events need the first to dispatch, the second to propagate up to window\n    this._ownerDocument = window.document;\n  }\n\n\n  // Aborts the request if it has already been sent.\n  abort() {\n    // Tell any pending request it has been aborted.\n    const request = this._pending;\n    if (this.readyState === XMLHttpRequest.UNSENT || (this.readyState === XMLHttpRequest.OPENED && !request.sent)) {\n      this.readyState = XMLHttpRequest.UNSENT;\n      return;\n    }\n\n    // Tell any pending request it has been aborted.\n    request.aborted = true;\n  }\n\n\n  // Initializes a request.\n  //\n  // Calling this method an already active request (one for which open()or\n  // openRequest()has already been called) is the equivalent of calling abort().\n  open(method, url, useAsync, user, password) { // jshint ignore:line\n    if (useAsync === false)\n      throw new DOM.DOMException(DOM.NOT_SUPPORTED_ERR, 'Zombie does not support synchronous XHR requests');\n\n    // Abort any pending request.\n    this.abort();\n\n    // Check supported HTTP method\n    method = method.toUpperCase();\n    if (/^(CONNECT|TRACE|TRACK)$/.test(method))\n      throw new DOM.DOMException(DOM.SECURITY_ERR, 'Unsupported HTTP method');\n    if (!/^(DELETE|GET|HEAD|OPTIONS|POST|PUT)$/.test(method))\n      throw new DOM.DOMException(DOM.SYNTAX_ERR, 'Unsupported HTTP method');\n\n    const headers = {};\n\n    // Normalize the URL and check security\n    url = URL.parse(Utils.resolveHref(this._window.location.href, url));\n    // Don't consider port if they are standard for http and https\n    if ((url.protocol === 'https:' && url.port === '443') ||\n        (url.protocol === 'http:'  && url.port === '80'))\n      delete url.port;\n\n    if (!/^https?:$/i.test(url.protocol))\n      throw new DOM.DOMException(DOM.NOT_SUPPORTED_ERR, 'Only HTTP/S protocol supported');\n    url.hostname = url.hostname || this._window.location.hostname;\n    url.host = url.port ? `${url.hostname}:${url.port}` : url.hostname;\n    if (url.host !== this._window.location.host) {\n      headers.origin = `${this._window.location.protocol}//${this._window.location.host}`;\n      this._cors = headers.origin;\n    }\n    url.hash = null;\n    if (user)\n      url.auth = `${user}:${password}`;\n    // Used for logging requests\n    this._url       = URL.format(url);\n\n    // Reset response status\n    this._response  = null;\n    this._error     = null;\n\n    const request   = { method, headers, url: URL.format(url) };\n    this._pending   = request;\n    this._stateChanged(XMLHttpRequest.OPENED);\n  }\n\n\n  // Sets the value of an HTTP request header.You must call setRequestHeader()\n  // after open(), but before send().\n  setRequestHeader(header, value) {\n    if (this.readyState !== XMLHttpRequest.OPENED)\n      throw new DOM.DOMException(DOM.INVALID_STATE_ERR,  'Invalid state');\n    const request = this._pending;\n    request.headers[header.toString().toLowerCase()] = value.toString();\n  }\n\n\n  // Sends the request. If the request is asynchronous (which is the default),\n  // this method returns as soon as the request is sent. If the request is\n  // synchronous, this method doesn't return until the response has arrived.\n  send(data) {\n    // Request must be opened.\n    if (this.readyState !== XMLHttpRequest.OPENED)\n      throw new DOM.DOMException(DOM.INVALID_STATE_ERR,  'Invalid state');\n\n    const request = this._pending;\n    this._fire('loadstart');\n\n    request.headers['content-type'] = request.headers['content-type'] || 'text/plain';\n    // Make the actual request\n    request.body    = data;\n    request.timeout = this.timeout;\n\n    this._window._eventQueue.http(request.method, request.url, request, (error, response)=> {\n      if (this._pending === request)\n        this._pending = null;\n\n      // Request aborted\n      if (request.aborted) {\n        this._stateChanged(XMLHttpRequest.DONE);\n        this._fire('progress');\n        this._error = new DOM.DOMException(DOM.ABORT_ERR, 'Request aborted');\n        this._fire('abort', this._error);\n        return;\n      }\n\n      if (error) {\n        this._stateChanged(XMLHttpRequest.DONE);\n        this._fire('progress');\n        if (error.code === 'ETIMEDOUT') {\n          this._error = new DOM.DOMException(DOM.TIMEOUT_ERR, 'The request timed out');\n          this._fire('timeout', this._error);\n        } else {\n          this._error = new DOM.DOMException(DOM.NETWORK_ERR, error.message);\n          this._fire('error', this._error);\n        }\n        this._fire('loadend');\n        this._browser.errors.push(this._error);\n        return;\n      }\n\n      // CORS request, check origin, may lead to new error\n      if (this._cors) {\n        const allowedOrigin = response.headers['access-control-allow-origin'];\n        if (!(allowedOrigin === '*' || allowedOrigin === this._cors)) {\n          this._error = new DOM.DOMException(DOM.SECURITY_ERR, 'Cannot make request to different domain');\n          this._browser.errors.push(this._error);\n          this._stateChanged(XMLHttpRequest.DONE);\n          this._fire('progress');\n          this._fire('error', this._error);\n          this._fire('loadend');\n          this.raise('error', this._error.message, { exception: this._error });\n          return;\n        }\n      }\n\n      // Store the response so getters have acess access it\n      this._response        = response;\n      // We have a one-stop implementation that goes through all the state\n      // transitions\n      this._stateChanged(XMLHttpRequest.HEADERS_RECEIVED);\n      this._stateChanged(XMLHttpRequest.LOADING);\n      this._stateChanged(XMLHttpRequest.DONE);\n\n      this._fire('progress');\n      this._fire('load');\n      this._fire('loadend');\n\n    });\n    request.sent = true;\n  }\n\n\n  get status() {\n    // Status code/headers available immediatly, 0 if request errored\n    return this._response ? this._response.statusCode :\n           this._error    ? 0 : null;\n  }\n\n  get statusText() {\n    // Status code/headers available immediatly, '' if request errored\n    return this._response ? this._response.statusText :\n           this._error    ? '' : null;\n  }\n\n  get responseText() {\n    // Response body available only after LOADING event, check for response\n    // since DONE event triggered in all cases\n    const hasBody = (this._response && this.readyState >= XMLHttpRequest.LOADING);\n    if (hasBody) {\n      const body = this._response.body;\n      return Buffer.isBuffer(body) ? body.toString() : body;\n    } else\n      return null;\n  }\n\n  get responseXML() {\n    // Not implemented yet\n    return null;\n  }\n\n  getResponseHeader(name) {\n    // Returns the string containing the text of the specified header, or null if\n    // either the response has not yet been received or the header doesn't exist in\n    // the response.\n    return this._response && this._response.headers[name.toLowerCase()] || null;\n  }\n\n  getAllResponseHeaders() {\n    // Returns all the response headers as a string, or null if no response has\n    // been received. Note: For multipart requests, this returns the headers from\n    // the current part of the request, not from the original channel.\n    if (this._response)\n      // XHR's getAllResponseHeaders, against all reason, returns a multi-line\n      // string.  See http://www.w3.org/TR/XMLHttpRequest/#the-getallresponseheaders-method\n      return Object.keys(this._response.headers)\n        .map(name => [name.toLowerCase(), this._response.headers[name]] )\n        .map(pair => pair.join(': ') )\n        .join('\\n');\n    else\n      return null;\n  }\n\n\n  // Fire onreadystatechange event\n  _stateChanged(newState) {\n    this.readyState = newState;\n    this._fire('readystatechange');\n  }\n\n  // Fire the named event on this object\n  _fire(eventName, error) {\n    const event = new DOM.Event('xhr');\n    event.initEvent(eventName, true, true);\n    event.error = error;\n    this.dispatchEvent(event);\n    this._browser.emit('xhr', eventName, this._url);\n  }\n\n  // Raise error coming from jsdom\n  raise(type, message, data) {\n    this._ownerDocument.raise(type, message, data);\n  }\n\n}\n\n\n// Lifecycle states\nXMLHttpRequest.UNSENT           = 0;\nXMLHttpRequest.OPENED           = 1;\nXMLHttpRequest.HEADERS_RECEIVED = 2;\nXMLHttpRequest.LOADING          = 3;\nXMLHttpRequest.DONE             = 4;\n\nmodule.exports = XMLHttpRequest;\n\n"],"sourceRoot":"/source/"}