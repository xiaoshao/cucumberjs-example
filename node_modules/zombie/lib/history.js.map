{"version":3,"sources":["history.js"],"names":[],"mappings":"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","file":"history.js","sourcesContent":["// Window history.\n//\n// Each window belongs to a history. Think of history as a timeline, with\n// currently active window, and multiple previous and future windows. From that\n// window you can navigate backwards and forwards between all other windows that\n// belong to the same history.\n//\n// Each window also has a container: either a browser tab or an iframe. When\n// navigating in history, a different window (from the same history), replaces\n// the current window within its container.\n//\n// Containers have access to the currently active window, not the history\n// itself, so navigation has to alert the container when there's a change in the\n// currently active window.\n//\n// The history does so by calling a \"focus\" function. To create the first\n// window, the container must first create a new history and supply a focus\n// function. The result is another function it can use to create the new window.\n//\n// From there on, it can navigate in history and add new windows by chaing the\n// current location (or using assign/replace).\n//\n// It can be used like this:\n//\n//   active = null\n//   focus = (window)->\n//     active = window\n//   history = createHistory(browser, focus)\n//   window = history(url: url, name: name)\n\n\nconst assert        = require('assert');\nconst loadDocument  = require('./document');\nconst DOM           = require('./dom');\nconst URL           = require('url');\n\n\nclass Location {\n\n  constructor(history, url) {\n    this._history = history;\n    this._url = url || (history.current ? history.current.url : 'about:blank');\n  }\n\n  assign(url) {\n    this._history.assign(url);\n  }\n\n  replace(url) {\n    this._history.replace(url);\n  }\n\n  reload() {\n    this._history.reload();\n  }\n\n  toString() {\n    return this._url;\n  }\n\n  get hostname() {\n    return URL.parse(this._url).hostname;\n  }\n\n  set hostname(hostname) {\n    const newUrl = URL.parse(this._url);\n    if (newUrl.port)\n      newUrl.host = `${hostname}:${newUrl.port}`;\n    else\n      newUrl.host = hostname;\n    this.assign(URL.format(newUrl));\n  }\n\n  get href() {\n    return this._url;\n  }\n\n  set href(href) {\n    this.assign(URL.format(href));\n  }\n\n  get origin() {\n    return `${this.protocol}//${this.host}`;\n  }\n\n  get hash() {\n    return URL.parse(this._url).hash || '';\n  }\n\n  set hash(value) {\n    const url  = Object.assign(URL.parse(this._url), { hash: value });\n    this.assign(URL.format(url));\n  }\n\n  get host() {\n    return URL.parse(this._url).host || '';\n  }\n\n  set host(value) {\n    const url  = Object.assign(URL.parse(this._url), { host: value });\n    this.assign(URL.format(url));\n  }\n\n  get pathname() {\n    return URL.parse(this._url).pathname || '';\n  }\n\n  set pathname(value) {\n    const url  = Object.assign(URL.parse(this._url), { pathname: value });\n    this.assign(URL.format(url));\n  }\n\n  get port() {\n    return URL.parse(this._url).port || '';\n  }\n\n  set port(value) {\n    const url  = Object.assign(URL.parse(this._url), { port: value });\n    this.assign(URL.format(url));\n  }\n\n  get protocol() {\n    return URL.parse(this._url).protocol || '';\n  }\n\n  set protocol(value) {\n    const url  = Object.assign(URL.parse(this._url), { protocol: value });\n    this.assign(URL.format(url));\n  }\n\n  get search() {\n    return URL.parse(this._url).search || '';\n  }\n\n  set search(value) {\n    const url  = Object.assign(URL.parse(this._url), { search: value });\n    this.assign(URL.format(url));\n  }\n}\n\n\n// Returns true if the hash portion of the URL changed between the history entry\n// (entry) and the new URL we want to inspect (url).\nfunction hashChange(entry, url) {\n  if (!entry)\n    return false;\n  const [aBase, aHash] = url.split('#');\n  const [bBase, bHash] = entry.url.split('#');\n  return (aBase === bBase) && (aHash !== bHash);\n}\n\n// If window is not the top level window, return parent for creating new child\n// window, otherwise returns false.\nfunction parentFrom(window) {\n  if (window.parent !== window.getGlobal())\n    return window.parent;\n}\n\n\n// Entry has the following properties:\n// window      - Window for this history entry (may be shared with other entries)\n// url         - URL for this history entry\n// pushState   - Push state state\n// next        - Next entry in history\n// prev        - Previous entry in history\nclass Entry {\n\n  constructor(window, url, pushState) {\n    this.window     = window;\n    this.url        = URL.format(url);\n    this.pushState  = pushState;\n    this.prev       = null;\n    this.next       = null;\n  }\n\n  // Called to destroy this entry. Used when we destroy the entire history,\n  // closing all windows. But also used when we replace one entry with another,\n  // and there are two cases to worry about:\n  // - The current entry uses the same window as the previous entry, we get rid\n  //   of the entry, but must keep the entry intact\n  // - The current entry uses the same window as the new entry, also need to\n  //   keep window intact\n  //\n  // keepAlive - Call destory on every document except this one, since it's\n  //             being replaced.\n  destroy(keepAlive) {\n    if (this.next) {\n      this.next.destroy(keepAlive || this.window);\n      this.next = null;\n    }\n    // Do not close window if replacing entry with same window\n    if (keepAlive === this.window)\n      return;\n    // Do not close window if used by previous entry in history\n    if (this.prev && this.prev.window === this.window)\n      return;\n    this.window._destroy();\n  }\n\n  append(newEntry, keepAlive) {\n    if (this.next)\n      this.next.destroy(keepAlive);\n    newEntry.prev = this;\n    this.next = newEntry;\n  }\n\n}\n\n\nclass History {\n\n  constructor(browser, focus) {\n    this.browser  = browser;\n    this.focus    = focus;\n    this.first    = null;\n    this.current  = null;\n  }\n\n  // Opens the first window and returns it.\n  open(args) {\n    args.browser = this.browser;\n    args.history = this;\n    const document  = loadDocument(args);\n    const window    = document.parentWindow;\n    this.addEntry(window, args.url);\n    return window;\n  }\n\n  // Dispose of all windows in history\n  destroy() {\n    this.focus(null);\n    // Re-entrant\n    const first   = this.first;\n    this.first    = null;\n    this.current  = null;\n    if (first)\n      first.destroy();\n  }\n\n  // Add a new entry.  When a window opens it call this to add itself to history.\n  addEntry(window, url = window.location.href, pushState = undefined) {\n    const entry = new Entry(window, url, pushState);\n    if (this.current) {\n      this.current.append(entry);\n      this.current  = entry;\n    } else {\n      this.first    = entry;\n      this.current  = entry;\n    }\n    this.focus(window);\n  }\n\n  // Replace current entry with a new one.\n  replaceEntry(window, url = window.location.href, pushState = undefined) {\n    const entry = new Entry(window, url, pushState);\n    if (this.current === this.first) {\n      if (this.current)\n        this.current.destroy(window);\n      this.first    = entry;\n      this.current  = entry;\n    } else {\n      this.current.prev.append(entry, window);\n      this.current  = entry;\n    }\n    this.focus(window);\n  }\n\n  // Call with two argument to update window.location and current.url to new URL\n  updateLocation(window, url) {\n    if (window === this.current)\n      this.current.url = url;\n    window.document._URL       = url;\n    window.document._location  = new Location(this, url);\n  }\n\n  // Returns window.location\n  get location() {\n    return new Location(this);\n  }\n\n\n  // Form submission\n  submit(args) {\n    args.browser   = this.browser;\n    args.history   = this;\n    const { window }  = this.current;\n    if (window) {\n      args.name      = window.name;\n      args.parent    = parentFrom(window);\n      args.referrer  = window.location.href;\n    }\n    const document  = loadDocument(args);\n    this.addEntry(document.parentWindow, document.location.href);\n  }\n\n  // Returns current URL.\n  get url() {\n    return this.current && this.current.url;\n  }\n\n\n  // -- Implementation of window.history --\n\n  // This method is available from Location, used to navigate to a new page.\n  assign(url) {\n    let name    = '';\n    let parent  = null;\n\n    if (this.current) {\n      url     = DOM.resourceLoader.resolve(this.current.window.document, url);\n      name    = this.current.window.name;\n      parent  = parentFrom(this.current.window);\n    }\n    if (this.current && this.current.url === url) {\n      this.replace(url);\n      return;\n    }\n\n    if (hashChange(this.current, url)) {\n      const { window } = this.current;\n      this.updateLocation(window, url);\n      this.addEntry(window, url); // Reuse window with new URL\n      const event = window.document.createEvent('HTMLEvents');\n      event.initEvent('hashchange', true, false);\n      window._eventQueue.enqueue(function() {\n        window.dispatchEvent(event);\n      });\n    } else {\n      const args = {\n        browser:  this.browser,\n        history:  this,\n        name:     name,\n        url:      url,\n        parent:   parent,\n        referrer: this.current.window.document.referrer\n      };\n      const document = loadDocument(args);\n      this.addEntry(document.parentWindow, url);\n    }\n  }\n\n  // This method is available from Location, used to navigate to a new page.\n  replace(url) {\n    url = URL.format(url);\n    let name = '';\n\n    if (this.current) {\n      url = DOM.resourceLoader.resolve(this.current.window.document, url);\n      name = this.current.window.name;\n    }\n\n    if (hashChange(this.current, url)) {\n      const { window } = this.current;\n      this.replaceEntry(window, url); // Reuse window with new URL\n      const event = window.document.createEvent('HTMLEvents');\n      event.initEvent('hashchange', true, false);\n      window._eventQueue.enqueue(function() {\n        window.dispatchEvent(event);\n      });\n    } else {\n      const args = {\n        browser:  this.browser,\n        history:  this,\n        name:     name,\n        url:      url,\n        parent:   parentFrom(this.current.window)\n      };\n      const document = loadDocument(args);\n      this.replaceEntry(document.parentWindow, url);\n    }\n  }\n\n  reload() {\n    const { window } = this.current.window;\n    if (window) {\n      const url   = window.location.href;\n      const args  = {\n        browser:  this.browser,\n        history:  this,\n        name:     window.name,\n        url:      url,\n        parent:   parentFrom(window),\n        referrer: window.document.referrer\n      };\n      const document = loadDocument(args);\n      this.replaceEntry(document.parentWindow, url);\n    }\n  }\n\n  // This method is available from Location.\n  go(amount) {\n    const was = this.current;\n    while (amount > 0) {\n      if (this.current.next)\n        this.current = this.current.next;\n      --amount;\n    }\n    while (amount < 0) {\n      if (this.current.prev)\n        this.current = this.current.prev;\n      ++amount;\n    }\n\n    // If moving from one page to another\n    if (this.current && was && this.current !== was) {\n      const { window } = this.current;\n      this.updateLocation(window, this.current.url);\n      this.focus(window);\n\n      if (this.current.pushState || was.pushState) {\n        // Created with pushState/replaceState, send popstate event if navigating\n        // within same host.\n        const oldHost = URL.parse(was.url).host;\n        const newHost = URL.parse(this.current.url).host;\n        if (oldHost === newHost) {\n          const popstate = window.document.createEvent('HTMLEvents');\n          popstate.initEvent('popstate', false, false);\n          popstate.state = this.current.pushState;\n          window._eventQueue.enqueue(function() {\n            window.dispatchEvent(popstate);\n          });\n        }\n      } else if (hashChange(was, this.current.url)) {\n        const hashchange = window.document.createEvent('HTMLEvents');\n        hashchange.initEvent('hashchange', true, false);\n        window._eventQueue.enqueue(function() {\n          window.dispatchEvent(hashchange);\n        });\n      }\n    }\n  }\n\n\n  // This method is available from Location.\n  get length() {\n    let entry = this.first;\n    let length = 0;\n    while (entry) {\n      ++length;\n      entry = entry.next;\n    }\n    return length;\n  }\n\n\n  // This method is available from Location.\n  pushState(state, title, url = this.url) {\n    url = DOM.resourceLoader.resolve(this.current.window.document, url);\n    // TODO: check same origin\n    this.addEntry(this.current.window, url, state || {});\n    this.updateLocation(this.current.window, url);\n  }\n\n  // This method is available from Location.\n  replaceState(state, title, url = this.url) {\n    url = DOM.resourceLoader.resolve(this.current.window.document, url);\n    // TODO: check same origin\n    this.replaceEntry(this.current.window, url, state || {});\n    this.updateLocation(this.current.window, url);\n  }\n\n  // This method is available from Location.\n  get state() {\n    return this.current.pushState;\n  }\n\n\n  dump(output = process.stdout) {\n    for (let entry = this.first, i = 1; entry; entry = entry.next, ++i)\n      output.write(`${i}: ${URL.format(entry.url)}\\n`);\n  }\n}\n\n\n// Creates and returns a new history.\n//\n// browser - The browser object\n// focus   - The focus method, called when a new window is in focus\n//\n// Returns a function for opening a new window, which accepts:\n// name      - Window name (optional)\n// opener    - Opening window (window.open call)\n// parent    - Parent window (for frames)\n// url       - Set document location to this URL upon opening\nmodule.exports = function createHistory(browser, focus) {\n  assert(browser && browser.visit, 'Missing parameter browser');\n  assert(focus && focus.call, 'Missing parameter focus or not a function');\n  const history = new History(browser, focus);\n  return history.open.bind(history);\n};\n\n"],"sourceRoot":"/source/"}