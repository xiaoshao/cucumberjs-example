{"version":3,"sources":["document.js"],"names":[],"mappings":"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","file":"document.js","sourcesContent":["// Exports a function for creating/loading new documents.\n\nconst assert                  = require('assert');\nconst { browserAugmentation } = require('jsdom/lib/jsdom/browser');\nconst browserFeatures         = require('jsdom/lib/jsdom/browser/documentfeatures');\nconst Window                  = require('jsdom/lib/jsdom/browser/Window');\nconst DOM                     = require('./dom');\nconst EventSource             = require('eventsource');\nconst WebSocket               = require('ws');\nconst XMLHttpRequest          = require('./xhr');\nconst URL                     = require('url');\nconst Utils                   = require('jsdom/lib/jsdom/utils');\n\n\n// File access, not implemented yet\nclass File {\n}\n\n\n// Screen object provides access to screen dimensions\nclass Screen {\n  constructor() {\n    this.top = this.left = 0;\n    this.width = 1280;\n    this.height = 800;\n  }\n\n  get availLeft() {\n    return 0;\n  }\n  get availTop() {\n    return 0;\n  }\n  get availWidth() {\n    return 1280;\n  }\n  get availHeight() {\n    return 800;\n  }\n  get colorDepth() {\n    return 24;\n  }\n  get pixelDepth() {\n    return 24;\n  }\n}\n\n\n// DOM implementation of URL class\nclass DOMURL {\n\n  constructor(url, base) {\n    assert(url != null, new DOM.DOMException('Failed to construct \\'URL\\': Invalid URL'));\n    if (base)\n      url = Utils.resolveHref(base, url);\n    const parsed = URL.parse(url || 'about:blank');\n    const origin = parsed.protocol && parsed.hostname && `${parsed.protocol}//${parsed.hostname}`;\n    Object.defineProperties(this, {\n      hash:     { value: parsed.hash,         enumerable: true },\n      host:     { value: parsed.host,         enumerable: true },\n      hostname: { value: parsed.hostname,     enumerable: true },\n      href:     { value: URL.format(parsed),  enumerable: true },\n      origin:   { value: origin,              enumerable: true },\n      password: { value: parsed.password,     enumerable: true },\n      pathname: { value: parsed.pathname,     enumerable: true },\n      port:     { value: parsed.port,         enumerable: true },\n      protocol: { value: parsed.protocol,     enumerable: true  },\n      search:   { value: parsed.search,       enumerable: true },\n      username: { value: parsed.username,     enumerable: true }\n    });\n  }\n\n  toString() {\n    return this.href;\n  }\n\n}\n\n\nfunction setupWindow(window, args) {\n  const { document }          = window;\n  const global                = window.getGlobal();\n  const { browser, history }  = args;\n  const { parent, opener }    = args;\n\n  let   closed        = false;\n\n  // Access to browser\n  Object.defineProperty(window, 'browser', {\n    value:      browser,\n    enumerable: true\n  });\n\n  window.name = args.name || '';\n\n  // If this is an iframe within a parent window\n  if (parent) {\n    window.parent = parent;\n    window.top    = parent.top;\n  } else {\n    window.parent = global;\n    window.top    = global;\n  }\n\n  // If this was opened from another window\n  window.opener   = opener;\n\n  window.console = browser.console;\n\n  // javaEnabled, present in browsers, not in spec Used by Google Analytics see\n  /// https://developer.mozilla.org/en/DOM/window.navigator.javaEnabled\n  const emptySet = [];\n  emptySet.item = ()=> undefined;\n  emptySet.namedItem = ()=> undefined;\n  window.navigator = {\n    appName:        'Zombie',\n    cookieEnabled:  true,\n    javaEnabled:    ()=> false,\n    language:       browser.language,\n    mimeTypes:      emptySet,\n    noUI:           true,\n    platform:       process.platform,\n    plugins:        emptySet,\n    userAgent:      browser.userAgent,\n    vendor:         'Zombie Industries'\n  };\n\n  // Add cookies, storage, alerts/confirm, XHR, WebSockets, JSON, Screen, etc\n  Object.defineProperty(window, 'cookies', {\n    get() {\n      return browser.cookies.serialize(this.location.hostname, this.location.pathname);\n    }\n  });\n  browser._storages.extend(window);\n\n  window.File =           File;\n  window.Event =          DOM.Event;\n  window.MouseEvent =     DOM.MouseEvent;\n  window.MutationEvent =  DOM.MutationEvent;\n  window.UIEvent =        DOM.UIEvent;\n  window.screen =         new Screen();\n\n  // Base-64 encoding/decoding\n  window.atob = (string)=> new Buffer(string, 'base64').toString('utf8');\n  window.btoa = (string)=> new Buffer(string, 'utf8').toString('base64');\n\n  // Constructor for XHLHttpRequest\n  window.XMLHttpRequest = ()=> new XMLHttpRequest(window);\n  window.URL = DOMURL;\n\n  // Web sockets\n  window.WebSocket = function(url, protocol) {\n    url = DOM.resourceLoader.resolve(document, url);\n    const origin = `${window.location.protocol}//${window.location.host}`;\n    return new WebSocket(url, { origin, protocol });\n  };\n\n  window.Image = function(width, height) {\n    const img   = new DOM.HTMLImageElement(window.document);\n    img.width   = width;\n    img.height  = height;\n    return img;\n  };\n\n  // DataView: get from globals\n  window.DataView = DataView;\n\n  window.resizeTo = function(width, height) {\n    window.outerWidth   = window.innerWidth   = width;\n    window.outerHeight  = window.innerHeight  = height;\n  };\n  window.resizeBy = function(width, height) {\n    window.resizeTo(window.outerWidth + width,  window.outerHeight + height);\n  };\n\n  // Some libraries (e.g. Backbone) check that this property exists before\n  // deciding to use onhashchange, so we need to set it to null.\n  window.onhashchange = null;\n\n\n\n  // -- JavaScript evaluation\n\n  // Evaulate in context of window. This can be called with a script (String) or a function.\n  window._evaluate = function(code, filename) {\n    const originalInScope = browser._windowInScope;\n    try {\n      // The current window, postMessage and window.close need this\n      browser._windowInScope = window;\n      let result;\n      if (typeof code === 'string' || code instanceof String)\n        result = global.run(code, filename);\n      else if (code)\n        result = code.call(global);\n      browser.emit('evaluated', code, result, filename);\n      return result;\n    } catch (error) {\n      error.filename = error.filename || filename;\n      throw error;\n    } finally {\n      browser._windowInScope = originalInScope;\n    }\n  };\n\n\n  // -- Event loop --\n\n  const eventQueue = browser._eventLoop.createEventQueue(window);\n  Object.defineProperty(window, '_eventQueue', {\n    value: eventQueue\n  });\n  window.setTimeout     = eventQueue.setTimeout.bind(eventQueue);\n  window.clearTimeout   = eventQueue.clearTimeout.bind(eventQueue);\n  window.setInterval    = eventQueue.setInterval.bind(eventQueue);\n  window.clearInterval  = eventQueue.clearInterval.bind(eventQueue);\n  window.setImmediate   = (fn)=> eventQueue.setTimeout(fn, 0);\n  window.clearImmediate = eventQueue.clearTimeout.bind(eventQueue);\n  window.requestAnimationFrame  = window.setImmediate;\n\n\n  // Constructor for EventSource, URL is relative to document's.\n  window.EventSource = function(url) {\n    url = DOM.resourceLoader.resolve(document, url);\n    const eventSource = new EventSource(url);\n    eventQueue.addEventSource(eventSource);\n    return eventSource;\n  };\n\n\n  // -- Interaction --\n\n  window.alert = function(message) {\n    const handled = browser.emit('alert', message);\n    if (!handled)\n      browser.log('Unhandled window.alert(\"%s\")');\n    browser.log('alert(\"%s\")', message);\n  };\n\n  window.confirm = function(question) {\n    const event     = { question, response: true };\n    const handled   = browser.emit('confirm', event);\n    if (!handled)\n      browser.log('Unhandled window.confirm(\"%s\")');\n    const response  = !!event.response;\n    browser.log('confirm(\"%s\") -> %ss', question, response);\n    return response;\n  };\n\n  window.prompt = function(question, value) {\n    const event     = { question, response: value || '' };\n    const handled   = browser.emit('prompt', event);\n    if (!handled)\n      browser.log('Unhandled window.prompt(\"%s\")');\n    const response  = (event.response || '').toString();\n    browser.log('prompt(\"..\") -> \"%s\"', question, response);\n    return response;\n  };\n\n\n  // -- Opening and closing --\n\n  // Open one window from another.\n  window.open = function(url, name, features) { // jshint unused:false\n    url = url && DOM.resourceLoader.resolve(document, url);\n    return browser.tabs.open({ name: name, url: url, opener: window });\n  };\n\n  // Indicates if window was closed\n  Object.defineProperty(window, 'closed', {\n    get() { return closed; },\n    enumerable: true\n  });\n\n  // Destroy all the history (and all its windows), frames, and Contextify\n  // global.\n  window._destroy = function() {\n    // We call history.destroy which calls destroy on all windows, so need to\n    // avoid infinite loop.\n    if (closed)\n      return;\n\n    closed = true;\n    // Close all frames first\n    for (let i = 0; i < window.length; ++i)\n      window[i].close();\n    // kill event queue, document and window.\n    eventQueue.destroy();\n    document.close();\n    window.dispose();\n  };\n\n  // window.close actually closes the tab, and disposes of all windows in the history.\n  // Also used to close iframe.\n  window.close = function() {\n    if (parent || closed)\n      return;\n    // Only opener window can close window; any code that's not running from\n    // within a window's context can also close window.\n    if (browser._windowInScope === opener || browser._windowInScope === null) {\n      // Only parent window gets the close event\n      browser.emit('closed', window);\n      window._destroy();\n      history.destroy(); // do this last to prevent infinite loop\n    } else\n      browser.log('Scripts may not close windows that were not opened by script');\n  };\n\n\n  // -- Navigating --\n\n  // Each window maintains its own view of history\n  const windowHistory = {\n    forward() {\n      windowHistory.go(1);\n    },\n    back() {\n      windowHistory.go(-1);\n    },\n    go(amount) {\n      history.go(amount);\n    },\n    pushState(...stateArgs) {\n      history.pushState(...stateArgs);\n    },\n    replaceState(...stateArgs) {\n      history.replaceState(...stateArgs);\n    },\n    dump(output) {\n      history.dump(output);\n    }\n  };\n  Object.defineProperties(windowHistory, {\n    length: {\n      get() { return history.length; },\n      enumerable: true\n    },\n    state: {\n      get() { return history.state; },\n      enumerable: true\n    }\n  });\n\n  // DOM History object\n  window.history  = windowHistory;\n  /// Actual history, see location getter/setter\n  window._history = history;\n\n\n  // Form submission uses this\n  window._submit = function(formArgs) {\n    const url     = DOM.resourceLoader.resolve(document, formArgs.url);\n    const target  = formArgs.target || '_self';\n    browser.emit('submit', url, target);\n    // Figure out which history is going to handle this\n    const targetWindow =\n      (target === '_self')   ? window :\n      (target === '_parent') ? window.parent :\n      (target === '_top')    ? window.top :\n      browser.tabs.open({ name: target });\n    const modified = Object.assign({}, formArgs, { url, target });\n    targetWindow._history.submit(modified);\n  };\n\n  // JSDOM fires DCL event on document but not on window\n  function windowLoaded(event) {\n    document.removeEventListener('DOMContentLoaded', windowLoaded);\n    window.dispatchEvent(event);\n  }\n  document.addEventListener('DOMContentLoaded', windowLoaded);\n\n  // Window is now open, next load the document.\n  browser.emit('opened', window);\n}\n\n\n// Change location, bypass JSDOM history\nWindow.prototype.__defineSetter__('location', function(url) {\n  return this._history.assign(url);\n});\n\n// Change location\nDOM.Document.prototype.__defineSetter__('location', function(url) {\n  this.parentWindow.location = url;\n});\n\n\n// Help iframes talking with each other\nWindow.prototype.postMessage = function(data) { // jshint unused:false\n  // Create the event now, but dispatch asynchronously\n  const event = this.document.createEvent('MessageEvent');\n  event.initEvent('message', false, false);\n  event.data = data;\n  // Window A (source) calls B.postMessage, to determine A we need the\n  // caller's window.\n\n  // DDOPSON-2012-11-09 - _windowInScope.getGlobal() is used here so that for\n  // website code executing inside the sandbox context, event.source ==\n  // window. Even though the _windowInScope object is mapped to the sandboxed\n  // version of the object returned by getGlobal, they are not the same object\n  // ie, _windowInScope.foo == _windowInScope.getGlobal().foo, but\n  // _windowInScope != _windowInScope.getGlobal()\n  event.source = (this.browser._windowInScope || this).getGlobal();\n  const origin = event.source.location;\n  event.origin = URL.format({ protocol: origin.protocol, host: origin.host });\n  this.dispatchEvent(event);\n};\n\n\n\n\n// Creates an returns a new document attached to the window.\nfunction createDocument(args) {\n  const { browser } = args;\n\n  const features = {\n    FetchExternalResources:   [],\n    ProcessExternalResources: [],\n    MutationEvents:           '2.0'\n  };\n  if (browser.hasFeature('scripts', true)) {\n    features.FetchExternalResources.push('script');\n    features.ProcessExternalResources.push('script');\n  }\n  if (browser.hasFeature('css', false)) {\n    features.FetchExternalResources.push('css');\n    features.FetchExternalResources.push('link');\n  }\n  if (browser.hasFeature('img', false))\n    features.FetchExternalResources.push('img');\n  if (browser.hasFeature('iframe', true))\n    features.FetchExternalResources.push('iframe');\n\n  // Based on JSDOM.jsdom but skips the document.write\n  // Calling document.write twice leads to strange results\n  const dom       = browserAugmentation(DOM, { parsingMode: 'html' });\n  const document  = new dom.HTMLDocument({ url: args.url, referrer: args.referrer, parsingMode: 'html' });\n  browserFeatures.applyDocumentFeatures(document, features);\n  const window    = document.parentWindow;\n  Object.defineProperty(document, 'window', {\n    value:      window,\n    enumerable: true\n  });\n  setupWindow(window, args);\n\n  // Give event handler chance to register listeners.\n  browser.emit('loading', document);\n  return document;\n}\n\n\n\n\nfunction getMetaRefreshURL(document) {\n  const refresh = document.querySelector('meta[http-equiv=\"refresh\"]');\n  if (refresh) {\n    const content = refresh.getAttribute('content');\n    const match   = content.match(/^\\s*(\\d+)(?:\\s*;\\s*url\\s*=\\s*(.*?))?\\s*(?:;|$)/i);\n    if (match) {\n      const refreshTimeout = parseInt(match[1], 10);\n      const refreshURL     = match[2] || document.location.href;\n      if (refreshTimeout >= 0)\n        return refreshURL;\n    }\n  }\n  return null;\n}\n\n\n// Load/create a new document.\n//\n// Named arguments:\n// browser   - The browser (required)\n// history   - Window history (required)\n// url       - URL of document to open (defaults to \"about:blank\")\n// method    - HTTP method (defaults to \"GET\")\n// encoding  - Request content type (forms use this)\n// params    - Additional request parameters\n// html      - Create document with this content instead of loading from URL\n// name      - Window name\n// referrer  - HTTP referer header\n// parent    - Parent document (for frames)\n// opener    - Opening window (for window.open)\n// target    - Target window name (for form.submit)\n//\n// Returns a new document with a new window.  The document contents is loaded\n// asynchronously, and will trigger a loaded/error event.\nmodule.exports = function loadDocument(args) {\n  const { browser, history } = args;\n  assert(browser && browser.visit, 'Missing parameter browser');\n  assert(history && history.reload, 'Missing parameter history');\n\n  let { url } = args;\n  if (url && browser.site) {\n    const site  = /^(https?:|file:)/i.test(browser.site) ? browser.site : `http://${browser.site}`;\n    url   = Utils.resolveHref(site, URL.format(url));\n  }\n  url     = url || 'about:blank';\n\n  const document = createDocument(Object.assign({ url }, args));\n  const window   = document.parentWindow;\n\n  if (args.html) {\n    window._eventQueue.enqueue(function() {\n      document.write(args.html); // jshint ignore:line\n      document.close();\n      browser.emit('loaded', document);\n    });\n    return document;\n  }\n\n  // Let's handle the specifics of each protocol\n  const { protocol, pathname } = URL.parse(url);\n  switch (protocol) {\n    case 'about:': {\n      window._eventQueue.enqueue(function() {\n        document.close();\n        browser.emit('loaded', document);\n      });\n      break;\n    }\n\n    case 'javascript:': {\n      window._eventQueue.enqueue(function() {\n        document.close();\n        try {\n          window._evaluate(pathname, 'javascript:');\n          browser.emit('loaded', document);\n        } catch (error) {\n          browser.emit('error', error);\n        }\n      });\n      break;\n    }\n\n    default: {\n      const method    = (args.method || 'GET').toUpperCase();\n      // Proceeed to load resource ...\n      const headers   = args.headers || {};\n      // HTTP header Referer, but Document property referrer\n      headers.referer = headers.referer || args.referrer || browser.referrer || browser.referer || history.url || '';\n      // Tell the browser we're looking for an HTML document\n      headers.accept  = headers.accept || 'text/html,*/*';\n      // Forms require content type\n      if (method === 'POST')\n        headers['content-type'] = args.encoding || 'application/x-www-form-urlencoded';\n\n      window._eventQueue.http(method, url, { headers, params: args.params, target: document }, (error, response)=> {\n        if (response) {\n          history.updateLocation(window, response.url);\n          window._response    = response;\n        }\n\n        if (response && response.statusCode >= 400)\n          error = new Error(`Server returned status code ${response.statusCode} from ${url}`);\n        if (error) {\n\n          // 4xx/5xx we get an error with an HTTP response\n          // Error in body of page helps with debugging\n          const message = (response && response.body) || error.message || error;\n          document.write(`<html><body>${message}</body></html>`); //jshint ignore:line\n          document.close();\n          browser.emit('error', error);\n\n        } else {\n\n          document.write(response.body); //jshint ignore:line\n          document.close();\n\n          // Handle meta refresh.  Automatically reloads new location and counts\n          // as a redirect.\n          //\n          // If you need to check the page before refresh takes place, use this:\n          //   browser.wait({\n          //     function: function() {\n          //       return browser.query('meta[http-equiv=\"refresh\"]');\n          //     }\n          //   });\n          const refreshURL = getMetaRefreshURL(document);\n          if (refreshURL)\n            // Allow completion function to run\n            window._eventQueue.enqueue(function() {\n              // Count a meta-refresh in the redirects count.\n              history.replace(refreshURL || document.location.href);\n              // This results in a new window getting loaded\n              const newWindow = history.current.window;\n              newWindow.addEventListener('load', function() {\n                newWindow._response.redirects++;\n              });\n            });\n          else if (document.documentElement)\n            browser.emit('loaded', document);\n          else\n            browser.emit('error', new Error(`Could not parse document at ${response.url}`));\n        }\n      });\n      break;\n    }\n  }\n\n  return document;\n};\n"],"sourceRoot":"/source/"}